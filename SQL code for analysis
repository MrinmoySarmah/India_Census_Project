select * from Appended


--- top 5 states in terms of voter turnout ratio for 2014 and 2019

select top 5 state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results1
group by state
order by voter_turnout_ratio desc


select top 5 state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results2
group by state
order by voter_turnout_ratio desc

--- bottom 5 states in terms of voter turnout ratio for 2014 and 2019

select top 5 state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results1
group by state
order by voter_turnout_ratio 


select top 5 state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results2
group by state
order by voter_turnout_ratio 

--- top 5 constituencies in terms of voter turnout ratio for 2014 and 2019

select top 5 pc_name,state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results1
group by pc_name,state
order by voter_turnout_ratio desc


select top 5 pc_name,state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results2
group by pc_name,state
order by voter_turnout_ratio desc

--- bottom 5 constituencies in terms of voter turnout ratio 2014 and 2019

select top 5 pc_name,state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results1
group by pc_name,state
order by voter_turnout_ratio


select top 5 pc_name,state,(sum(total_votes)/sum(distinct total_electors))*100 as voter_turnout_ratio from results1
group by pc_name,state
order by voter_turnout_ratio


---constituencies voting for same parties for both years

select pc_name as common_parties from(
select pc_name,party from
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results1)a)b
where rnk=1)c
where year = 2014
intersect
select pc_name,party from
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results2)a)b
where rnk=1)d  
) c


select top 10 t1.pc_name,t2.ratio-t1.ratio as ratio_diff from
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results1)a)b
where rnk=1) t1
join
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results2)a)b
where rnk=1) t2
on t1.pc_name = t2.pc_name and t1.year != t2.year
where t1.party = t2.party
order by ratio_diff desc


---constituencies voting for different parties for both years

select top 10 t1.pc_name,t2.ratio-t1.ratio as ratio_diff from
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results1)a)b
where rnk=1) t1
join
(select * from
(select *,dense_rank() over(partition by pc_name order by ratio desc) rnk from
(select pc_name,party,year,(total_votes/total_electors)*100 ratio from results2)a)b
where rnk=1) t2
on t1.pc_name = t2.pc_name and t1.year != t2.year
where t1.party !=t2.party
order by ratio_diff desc

---%split of votes of parties between 2014 at state level

select * from
(select *,dense_rank() over(partition by party order by votes desc) rnk from
(select state,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from results1
group by state,party)a)b
where rnk=1
order by votes desc

---%split of votes of parties between 2019 at state level

select * from
(select *,dense_rank() over(partition by party order by votes desc) rnk from
(select state,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from results2
group by state,party)a)b
where rnk=1
order by votes desc


---%split of votes of parties between 2014 at national level

select * from
(select *,dense_rank() over(partition by party order by votes desc) rnk from
(select party,(sum(total_votes)/sum(distinct total_electors))*100 votes from results1
group by party)a)b
where rnk=1
order by votes desc

---%split of votes of parties between 2019 at national level

select * from
(select *,dense_rank() over(partition by party order by votes desc) rnk from
(select party,(sum(total_votes)/sum(distinct total_electors))*100 votes from results2
group by party)a)b
where rnk=1
order by votes desc


---Top constituencies for two major parties where they have gained vote share in 2019 compared to 2014


select top 5 t1.pc_name,t1.party,t1.votes-t2.votes vote_diff from
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'BJP' and year=2019
group by party,pc_name) t1
join
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'BJP' and year=2014
group by party,pc_name) t2 on t1.pc_name=t2.pc_name
where t1.votes>t2.votes
order by vote_diff desc


select top 5 t1.pc_name,t1.party,t1.votes-t2.votes vote_diff from
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'INC' and year=2019
group by party,pc_name) t1
join
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'INC' and year=2014
group by party,pc_name) t2 on t1.pc_name=t2.pc_name
where t1.votes>t2.votes
order by vote_diff desc

---Top constituencies for two major parties where they have lost vote share in 2019 compared to 2014


select top 5 t1.pc_name,t1.party,t2.votes-t1.votes vote_diff from
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'BJP' and year=2019
group by party,pc_name) t1
join
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'BJP' and year=2014
group by party,pc_name) t2 on t1.pc_name=t2.pc_name
where t1.votes<t2.votes
order by vote_diff desc


select top 5 t1.pc_name,t1.party,t2.votes-t1.votes vote_diff from
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'INC' and year=2019
group by party,pc_name) t1
join
(select pc_name,party,(sum(total_votes)/sum(distinct total_electors))*100 votes from Appended
where party = 'INC' and year=2014
group by party,pc_name) t2 on t1.pc_name=t2.pc_name
where t1.votes<t2.votes
order by vote_diff desc

---constituency which voted the most for NOTA

select top 1 pc_name,sum(total_votes) votes from Appended
where party = 'NOTA'
group by pc_name
order by votes desc

---top 5 candidates based on margin difference with runners in 2014 and 2019

select top 5 * from
(select *,rank() over(partition by party order by total_votes desc) rnk from
(select candidate,party,sum(total_votes) total_votes from results1
where party != 'NOTA' and party != 'BJP'
group by candidate,party)a)b
where rnk =1
order by total_votes desc


select top 5 * from
(select *,rank() over(partition by party order by total_votes desc) rnk from
(select candidate,party,sum(total_votes) total_votes from results2
where party != 'NOTA' and party != 'BJP'
group by candidate,party)a)b
where rnk =1
order by total_votes desc


